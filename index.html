<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å…«æ–¹ç’°çƒ ERP V11.1</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    window.firebaseModules = { initializeApp, getDatabase, ref, set, onValue, remove };
  </script>

  <style>
    body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; }
    .loader { border: 3px solid #e2e8f0; border-top: 3px solid #3b82f6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* SVG åœ–ç¤ºæ¨£å¼ */
    .icon-svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    .icon-svg-sm { width: 16px; height: 16px; }
    .icon-svg-lg { width: 24px; height: 24px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // SVG åœ–ç¤ºçµ„ä»¶
    const Icons = {
      Star: ({filled, className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24" fill={filled ? "currentColor" : "none"}>
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
      ),
      Camera: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
          <circle cx="12" cy="13" r="4"/>
        </svg>
      ),
      Copy: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
      ),
      Trash: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <polyline points="3 6 5 6 21 6"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
        </svg>
      ),
      Plus: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      ),
      Eye: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
      ),
      Send: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
      ),
      Clock: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
      ),
      Save: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
          <polyline points="17 21 17 13 7 13 7 21"/>
          <polyline points="7 3 7 8 15 8"/>
        </svg>
      ),
      Sparkles: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
        </svg>
      ),
      DollarSign: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <line x1="12" y1="1" x2="12" y2="23"/>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
      ),
      Package: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/>
          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
          <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
          <line x1="12" y1="22.08" x2="12" y2="12"/>
        </svg>
      ),
      User: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      ),
      Upload: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="17 8 12 3 7 8"/>
          <line x1="12" y1="3" x2="12" y2="15"/>
        </svg>
      ),
      Settings: ({className=""}) => (
        <svg className={`icon-svg ${className}`} viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="3"/>
          <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"/>
        </svg>
      ),
    };

    // CONFIG
    const CONFIG = {
        firebase: {
            apiKey: "AIzaSyD59OwEnbcLZShhTTJJMu1VjJxrvzIcG_g",
            authDomain: "seafoodq-11b9d.firebaseapp.com",
            databaseURL: "https://seafoodq-11b9d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "seafoodq-11b9d",
            storageBucket: "seafoodq-11b9d.firebasestorage.app",
            messagingSenderId: "454420146806",
            appId: "1:454420146806:web:802e6bd5e8e90aab21cd57"
        },
        pwd: { ADMIN: "8888", SALES: "1688" }
    };

    // å·¥å…·å‡½å¼
    const cleanStr = (s) => s ? String(s).trim() : '';
    const sanitizeKey = (s) => s ? String(s).replace(/[.#$/\[\]]/g, '_').trim() : '';
    const parseNum = (v) => {
        if (!v) return 0;
        if (typeof v === 'number') return v;
        const n = String(v).replace(/,/g, '').match(/-?\d+(\.\d+)?/);
        return n ? parseFloat(n[0]) : 0;
    };

    let db = null;

    // ä¸»æ‡‰ç”¨
    const App = () => {
      const [page, setPage] = useState('login');
      const [role, setRole] = useState('');
      const [status, setStatus] = useState('æœªé€£ç·š');
      const [data, setData] = useState({ products: {}, inventory: {}, tiers: ['ç”Ÿæ„åƒ¹'], meta: {} });
      const [inputPwd, setInputPwd] = useState('');
      
      // å ±åƒ¹ç‹€æ…‹
      const [cart, setCart] = useState([]);
      const [custInfo, setCustInfo] = useState({ 
        name: '', phone: '', mobile: '', address: '', 
        date: new Date().toISOString().split('T')[0], tier: 'ç”Ÿæ„åƒ¹' 
      });
      const [favorites, setFavorites] = useState([]);
      const [quotes, setQuotes] = useState([]);
      const [showModal, setShowModal] = useState(null); // null, 'price', 'favorites', 'history'
      const [currentPriceItem, setCurrentPriceItem] = useState(null);

      // è¼‰å…¥æœ¬åœ°è³‡æ–™
      useEffect(() => {
        const saved = localStorage.getItem('erpQuoteLocal');
        if (saved) {
          try {
            const data = JSON.parse(saved);
            setFavorites(data.favorites || []);
            setQuotes(data.quotes || []);
          } catch (e) {}
        }
      }, []);

      // å„²å­˜æœ¬åœ°è³‡æ–™
      const saveLocal = () => {
        localStorage.setItem('erpQuoteLocal', JSON.stringify({ favorites, quotes }));
      };

      // Firebase åˆå§‹åŒ–
      const initDB = () => {
        if (db) return true;
        if (!window.firebaseModules) return false;
        try {
            const { initializeApp, getDatabase } = window.firebaseModules;
            const app = initializeApp(CONFIG.firebase);
            db = getDatabase(app);
            return true;
        } catch (e) {
            alert("Firebase åˆå§‹åŒ–å¤±æ•—: " + e.message);
            return false;
        }
      };

      // ç›£è½è³‡æ–™
      const listenDB = () => {
          if (!initDB()) return;
          const { ref, onValue } = window.firebaseModules;
          setStatus('é€£ç·šä¸­...');
          onValue(ref(db, 'seafoodData'), (snap) => {
              const val = snap.val();
              if (val) {
                  setData({
                      products: val.productDB || {},
                      inventory: val.inventoryDB || {},
                      tiers: val.priceTiers || ['ç”Ÿæ„åƒ¹'],
                      meta: val.dbMeta || {}
                  });
                  setStatus('â— å·²é€£ç·š');
              } else {
                  setStatus('â— è³‡æ–™åº«ç‚ºç©º');
              }
          }, (err) => setStatus('é€£ç·šéŒ¯èª¤'));
      };

      // ç™»å…¥
      const handleLogin = () => {
          if (inputPwd === CONFIG.pwd.ADMIN) {
              setRole('admin');
              setPage('quote');
              listenDB();
          } else if (inputPwd === CONFIG.pwd.SALES) {
              setRole('sales');
              setPage('quote');
              listenDB();
          } else {
              alert("å¯†ç¢¼éŒ¯èª¤");
          }
      };

      // Excel ä¸Šå‚³è™•ç†
      const handleUpload = (e, type) => {
          const file = e.target.files[0];
          if (!file) return;
          
          const reader = new FileReader();
          reader.onload = (evt) => {
              try {
                  const decoder = new TextDecoder("big5");
                  const csvText = decoder.decode(new Uint8Array(evt.target.result));
                  const wb = XLSX.read(csvText, { type: 'string' });
                  const ws = wb.Sheets[wb.SheetNames[0]];
                  const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                  
                  if (type === 'stock') processStock(rows);
                  else if (type === 'quote') processQuote(rows);

              } catch (err) {
                  alert("è®€å–å¤±æ•—ï¼š" + err.message);
              }
          };
          reader.readAsArrayBuffer(file);
          e.target.value = null;
      };

      const processStock = (rows) => {
          let headerIdx = -1;
          for(let i=0; i<Math.min(rows.length, 20); i++) {
              const str = rows[i].join('');
              if (str.includes('å“è™Ÿ') && (str.includes('åº«åˆ¥') || str.includes('å€‰åº«'))) {
                  headerIdx = i; break;
              }
          }
          if (headerIdx === -1) { alert("âŒ æ‰¾ä¸åˆ°æ¨™é¡Œåˆ—"); return; }

          const headers = rows[headerIdx].map(cleanStr);
          const rawData = rows.slice(headerIdx + 1);

          const idxPid = headers.findIndex(h => h.includes('å“è™Ÿ'));
          const idxName = headers.findIndex(h => h.includes('å“å'));
          const idxSpec = headers.findIndex(h => h.includes('è¦æ ¼'));
          const idxWh = headers.findIndex(h => h.includes('åº«åˆ¥') || h.includes('å€‰åº«'));
          const idxQty = headers.findIndex(h => h.includes('åº«å­˜') || h.includes('æ•¸é‡'));

          const newInv = {};
          const newProds = { ...data.products };
          let lastPid = null;
          let count = 0;
          let newProdCount = 0;

          rawData.forEach(row => {
              let pid = sanitizeKey(cleanStr(row[idxPid]));
              const wh = cleanStr(row[idxWh]);
              const qty = parseNum(row[idxQty]);
              
              if (!wh) return;

              if (!pid && lastPid) pid = lastPid;
              else if (pid) lastPid = pid;

              if (!pid) return;

              if (qty !== 0) {
                  if (!newInv[pid]) newInv[pid] = [];
                  if (!newInv[pid].some(x => x.warehouse === wh)) {
                      newInv[pid].push({ warehouse: wh, stock: qty });
                      count++;
                  }
              }

              const name = cleanStr(row[idxName]);
              if (name && newInv[pid]) {
                  const safeName = sanitizeKey(name);
                  if (!newProds[safeName]) newProds[safeName] = [];
                  if (!newProds[safeName].find(s => s.id === pid)) {
                      newProds[safeName].push({
                          id: pid, name: name, specDetail: cleanStr(row[idxSpec]),
                          prices: {"ç”Ÿæ„åƒ¹":0}, note: '(åº«å­˜è£œå…¥)', pack: 1, smallUnit:'ä»¶', bigUnit:'ä»¶'
                      });
                      newProdCount++;
                  }
              }
          });

          if (count > 0 && confirm(`è§£ææˆåŠŸï¼\nåº«å­˜ ${count} ç­†ï¼Œæ–°å“ ${newProdCount} ç­†ã€‚\nç¢ºèªä¸Šå‚³ï¼Ÿ`)) {
              uploadDB({ inventoryDB: newInv, productDB: newProds, dbMeta: { ...data.meta, stockDate: new Date().toLocaleString() } });
          } else if (count === 0) {
              alert("âŒ ç„¡æœ‰æ•ˆè³‡æ–™");
          }
      };

      const processQuote = (rows) => {
          let headerIdx = -1;
          for(let i=0; i<Math.min(rows.length, 20); i++) {
              if (rows[i].join('').includes('å“è™Ÿ')) { headerIdx = i; break; }
          }
          if (headerIdx === -1) { alert("âŒ æ‰¾ä¸åˆ°æ¨™é¡Œ"); return; }
          
          const headers = rows[headerIdx].map(cleanStr);
          const rawData = rows.slice(headerIdx + 1);
          
          const idxPid = headers.findIndex(h => h.includes('å“è™Ÿ') || h==='ID');
          const idxName = headers.findIndex(h => h.includes('å“å'));
          const idxSpec = headers.findIndex(h => h.includes('è¦æ ¼'));

          const newProds = {};
          const tiers = new Set();
          let count = 0;

          rawData.forEach(row => {
              const pid = sanitizeKey(cleanStr(row[idxPid]));
              const name = cleanStr(row[idxName]);
              if (!pid || !name) return;

              const prices = {};
              headers.forEach((h, i) => {
                  if ((h.includes('åƒ¹') || h.includes('+')) && !h.includes('è™Ÿ') && !h.includes('å')) {
                      const v = parseNum(row[i]);
                      if (v > 0) {
                          const t = h.replace('åƒ¹æ ¼','').replace('_','').trim();
                          prices[t] = v;
                          tiers.add(t);
                      }
                  }
              });

              const safeName = sanitizeKey(name);
              if (!newProds[safeName]) newProds[safeName] = [];
              newProds[safeName].push({
                  id: pid, name, specDetail: cleanStr(row[idxSpec]), prices,
                  pack: 1, smallUnit: 'ä»¶', bigUnit: 'ä»¶' 
              });
              count++;
          });

          if (count > 0 && confirm(`è§£æ ${count} ç­†å ±åƒ¹ï¼Œä¸Šå‚³ï¼Ÿ`)) {
              uploadDB({ productDB: newProds, priceTiers: Array.from(tiers), dbMeta: { ...data.meta, quoteDate: new Date().toLocaleString() } });
          }
      };

      const uploadDB = (updates) => {
          if (!initDB()) return;
          const { ref, set } = window.firebaseModules;
          const finalData = { 
              productDB: updates.productDB || data.products,
              inventoryDB: updates.inventoryDB || data.inventory,
              priceTiers: updates.priceTiers || data.tiers,
              dbMeta: updates.dbMeta || data.meta
          };
          set(ref(db, 'seafoodData'), finalData)
            .then(() => alert("âœ… ä¸Šå‚³æˆåŠŸ"))
            .catch(e => alert("ä¸Šå‚³å¤±æ•—: " + e.message));
      };

      // è³¼ç‰©è»Šæ“ä½œ
      const addToCart = () => {
        const item = {
          id: Date.now(),
          name: '',
          spec: '',
          qty: 0,
          unit: 'ä»¶',
          price: 0,
          note: '',
          image: '',
          isFavorite: false
        };
        setCart([...cart, item]);
      };

      const updateCart = (id, field, value) => {
        setCart(cart.map(item => item.id === id ? {...item, [field]: value} : item));
      };

      const deleteFromCart = (id) => {
        setCart(cart.filter(item => item.id !== id));
      };

      const copyCartItem = (id) => {
        const item = cart.find(i => i.id === id);
        if (item) {
          setCart([...cart, {...item, id: Date.now()}]);
        }
      };

      const toggleFavorite = (id) => {
        const item = cart.find(i => i.id === id);
        if (item) {
          const newCart = cart.map(i => i.id === id ? {...i, isFavorite: !i.isFavorite} : i);
          setCart(newCart);
          
          if (!item.isFavorite && item.name) {
            const fav = { name: item.name, spec: item.spec, price: item.price };
            const exists = favorites.some(f => f.name === fav.name && f.spec === fav.spec);
            if (!exists) {
              const newFavs = [...favorites, fav];
              setFavorites(newFavs);
              setTimeout(saveLocal, 100);
            }
          }
        }
      };

      const uploadImage = (id) => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
              updateCart(id, 'image', event.target.result);
            };
            reader.readAsDataURL(file);
          }
        };
        input.click();
      };

      const showPricePicker = (id) => {
        setCurrentPriceItem(id);
        setShowModal('price');
      };

      const selectPrice = (price) => {
        if (currentPriceItem) {
          updateCart(currentPriceItem, 'price', price);
          setShowModal(null);
          setCurrentPriceItem(null);
        }
      };

      const calculateSubtotal = (item) => item.qty * item.price;
      const calculateTotal = () => cart.reduce((sum, item) => sum + calculateSubtotal(item), 0);

      const saveQuote = () => {
        if (cart.length === 0) {
          alert('è«‹å…ˆæ–°å¢ç”¢å“');
          return;
        }
        const quote = {
          id: Date.now(),
          date: new Date().toISOString(),
          customer: {...custInfo},
          products: cart.map(p => ({...p})),
          total: calculateTotal()
        };
        const newQuotes = [...quotes, quote];
        setQuotes(newQuotes);
        setTimeout(saveLocal, 100);
        alert('å ±åƒ¹å·²å„²å­˜ï¼');
      };

      const loadQuote = (quoteId) => {
        const quote = quotes.find(q => q.id === quoteId);
        if (quote) {
          setCustInfo({...quote.customer});
          setCart(quote.products.map(p => ({...p, id: Date.now() + Math.random()})));
          setShowModal(null);
        }
      };

      const deleteQuote = (quoteId) => {
        if (confirm('ç¢ºå®šåˆªé™¤æ­¤å ±åƒ¹ï¼Ÿ')) {
          const newQuotes = quotes.filter(q => q.id !== quoteId);
          setQuotes(newQuotes);
          setTimeout(saveLocal, 100);
        }
      };

      const previewQuote = () => {
        if (cart.length === 0) {
          alert('è«‹å…ˆæ–°å¢ç”¢å“');
          return;
        }
        
        let html = `
          <html><head><meta charset="UTF-8"><title>å ±åƒ¹å–®</title>
          <style>
            body { font-family: Arial; padding: 40px; }
            h1 { text-align: center; margin-bottom: 30px; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
            th { background: #f3f4f6; }
            .total { text-align: right; font-size: 20px; font-weight: bold; margin-top: 20px; }
          </style></head><body>
          <h1>å ±åƒ¹å–®</h1>
          <p><strong>å®¢æˆ¶ï¼š</strong>${custInfo.name}</p>
          <p><strong>é›»è©±ï¼š</strong>${custInfo.phone}</p>
          <p><strong>æ‰‹æ©Ÿï¼š</strong>${custInfo.mobile}</p>
          <p><strong>åœ°å€ï¼š</strong>${custInfo.address}</p>
          <p><strong>æ—¥æœŸï¼š</strong>${custInfo.date}</p>
          <table><thead><tr>
            <th>é …æ¬¡</th><th>ç”¢å“åç¨±</th><th>è¦æ ¼</th><th>æ•¸é‡</th><th>å–®åƒ¹</th><th>å°è¨ˆ</th><th>å‚™è¨»</th>
          </tr></thead><tbody>
          ${cart.map((p, i) => `
            <tr>
              <td>${i + 1}</td>
              <td>${p.name}</td>
              <td>${p.spec}</td>
              <td>${p.qty} ${p.unit}</td>
              <td>$${p.price}</td>
              <td>$${calculateSubtotal(p).toLocaleString()}</td>
              <td>${p.note}</td>
            </tr>
          `).join('')}
          </tbody></table>
          <div class="total">ç¸½é‡‘é¡ï¼š$${calculateTotal().toLocaleString()}</div>
          </body></html>
        `;
        
        const win = window.open('', '_blank');
        win.document.write(html);
        win.document.close();
      };

      const shareToLine = () => {
        if (cart.length === 0) {
          alert('è«‹å…ˆæ–°å¢ç”¢å“');
          return;
        }
        
        let message = `ã€å ±åƒ¹å–®ã€‘\nå®¢æˆ¶ï¼š${custInfo.name}\næ—¥æœŸï¼š${custInfo.date}\n\n`;
        cart.forEach((p, i) => {
          message += `${i + 1}. ${p.name}\n   ${p.spec}\n   ${p.qty} ${p.unit} Ã— $${p.price} = $${calculateSubtotal(p)}\n`;
          if (p.note) message += `   å‚™è¨»ï¼š${p.note}\n`;
          message += `\n`;
        });
        message += `ç¸½é‡‘é¡ï¼š$${calculateTotal().toLocaleString()}`;
        
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(message)}`, '_blank');
      };

      // åƒ¹æ ¼ç­‰ç´š
      const priceTiers = {
        'ç”Ÿæ„åƒ¹': [280, 320, 350, 380, 420],
        'åŠ ç›Ÿåƒ¹': [300, 340, 370, 400, 450],
        'é›¶å”®åƒ¹': [350, 390, 420, 450, 500]
      };

      // ç™»å…¥é 
      if (page === 'login') {
        return (
          <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-50 to-indigo-100">
            <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-sm">
              <div className="text-center mb-8">
                <div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                  <Icons.Package className="icon-svg-lg text-white" />
                </div>
                <h1 className="text-3xl font-black text-gray-800">å…«æ–¹ç’°çƒ</h1>
                <p className="text-sm text-gray-500 mt-2">ERP å ±åƒ¹ç³»çµ± V11.1</p>
              </div>
              
              <input 
                type="password" 
                placeholder="è«‹è¼¸å…¥å¯†ç¢¼" 
                className="w-full p-4 border-2 border-gray-200 rounded-xl mb-4 text-center text-xl focus:border-blue-500 focus:outline-none transition-colors" 
                value={inputPwd} 
                onChange={e => setInputPwd(e.target.value)}
                onKeyPress={e => e.key === 'Enter' && handleLogin()}
              />
              
              <button 
                onClick={handleLogin} 
                className="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all hover:scale-[1.02]"
              >
                ç™»å…¥ç³»çµ±
              </button>
              
              <div className="mt-8 pt-6 border-t border-gray-200 text-center">
                <p className="text-xs text-gray-400 mb-3">æ¸¬è©¦å¯†ç¢¼ï¼šAdmin(8888) / Sales(1688)</p>
              </div>
            </div>
          </div>
        );
      }

      // ç®¡ç†å“¡é 
      if (page === 'admin') {
        return (
          <div className="min-h-screen bg-gray-50">
            <div className="bg-white px-4 py-3 border-b flex justify-between items-center sticky top-0 z-20 shadow-sm">
              <div>
                <h1 className="font-black text-lg">ç®¡ç†å“¡è¨­å®š</h1>
                <span className={`text-xs ${status.includes('å·²é€£ç·š')?'text-green-600':'text-gray-400'}`}>{status}</span>
              </div>
              <button onClick={() => setPage('quote')} className="bg-blue-500 text-white px-4 py-2 rounded-lg font-bold">è¿”å›å ±åƒ¹</button>
            </div>

            <div className="p-4 max-w-2xl mx-auto">
              <div className="bg-white p-6 rounded-xl shadow-lg mb-4">
                <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                  <Icons.Upload />
                  è³‡æ–™åŒ¯å…¥
                </h2>
                <div className="space-y-4">
                  <label className="block w-full p-6 border-2 border-dashed border-blue-300 bg-blue-50 text-center rounded-xl cursor-pointer hover:bg-blue-100 transition-colors">
                    <Icons.Package className="icon-svg-lg mx-auto mb-2 text-blue-600" />
                    <span className="text-blue-700 font-bold block">ğŸ“¦ ä¸Šå‚³åº«å­˜è¡¨ (XLSX/CSV)</span>
                    <span className="text-xs text-gray-500 block mt-2">éœ€åŒ…å«ï¼šå“è™Ÿã€å“åã€è¦æ ¼ã€åº«åˆ¥ã€åº«å­˜</span>
                    <input type="file" className="hidden" accept=".xlsx,.xls,.csv" onChange={e => handleUpload(e, 'stock')} />
                  </label>
                  
                  <label className="block w-full p-6 border-2 border-dashed border-green-300 bg-green-50 text-center rounded-xl cursor-pointer hover:bg-green-100 transition-colors">
                    <Icons.DollarSign className="icon-svg-lg mx-auto mb-2 text-green-600" />
                    <span className="text-green-700 font-bold block">ğŸ’° ä¸Šå‚³å ±åƒ¹è¡¨ (XLSX/CSV)</span>
                    <span className="text-xs text-gray-500 block mt-2">éœ€åŒ…å«ï¼šå“è™Ÿã€å“åã€è¦æ ¼ã€å„åƒ¹æ ¼ç­‰ç´š</span>
                    <input type="file" className="hidden" accept=".xlsx,.xls,.csv" onChange={e => handleUpload(e, 'quote')} />
                  </label>
                </div>
              </div>

              <div className="bg-white p-6 rounded-xl shadow-lg">
                <h2 className="font-bold text-lg mb-4">ç³»çµ±è³‡è¨Š</h2>
                <div className="space-y-2 text-sm">
                  <p><strong>è³‡æ–™åº«ç‹€æ…‹ï¼š</strong>{status}</p>
                  <p><strong>ç”¢å“æ•¸é‡ï¼š</strong>{Object.keys(data.products).length} é …</p>
                  <p><strong>åƒ¹æ ¼ç­‰ç´šï¼š</strong>{data.tiers.join(', ')}</p>
                  {data.meta.stockDate && <p><strong>åº«å­˜æ›´æ–°ï¼š</strong>{data.meta.stockDate}</p>}
                  {data.meta.quoteDate && <p><strong>å ±åƒ¹æ›´æ–°ï¼š</strong>{data.meta.quoteDate}</p>}
                </div>
              </div>
            </div>
          </div>
        );
      }

      // å ±åƒ¹é ï¼ˆéŸ¿æ‡‰å¼è¨­è¨ˆï¼‰
      const isMobile = typeof window !== 'undefined' && window.innerWidth <= 768;
      const total = calculateTotal();

      return (
        <div className="min-h-screen bg-gray-50">
          {/* æ¡Œé¢ç‰ˆ Header */}
          {!isMobile && (
            <div className="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-4 shadow-lg">
              <div className="max-w-7xl mx-auto flex justify-between items-center">
                <div className="flex items-center gap-3">
                  <Icons.Package className="icon-svg-lg" />
                  <div>
                    <h1 className="text-xl font-black">å…«æ–¹ç’°çƒ ERP</h1>
                    <p className="text-xs opacity-90">{status}</p>
                  </div>
                </div>
                <div className="flex gap-2">
                  {role === 'admin' && (
                    <button onClick={() => setPage('admin')} className="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-bold flex items-center gap-2">
                      <Icons.Settings className="icon-svg-sm" />
                      ç®¡ç†
                    </button>
                  )}
                  <button onClick={() => setPage('login')} className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg font-bold">
                    ç™»å‡º
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* æ‰‹æ©Ÿç‰ˆ Header */}
          {isMobile && (
            <div className="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-3 shadow-lg sticky top-0 z-50">
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <Icons.Package className="icon-svg" />
                  <div>
                    <h1 className="text-base font-black">å…«æ–¹ç’°çƒ ERP V11.1</h1>
                    <p className="text-xs opacity-90">{status}</p>
                  </div>
                </div>
                <div className="flex gap-2">
                  {role === 'admin' && (
                    <button onClick={() => setPage('admin')} className="bg-white/20 p-2 rounded-lg">
                      <Icons.Settings className="icon-svg-sm" />
                    </button>
                  )}
                  <button onClick={() => setPage('login')} className="bg-red-500 px-3 py-1.5 rounded-lg text-sm font-bold">
                    ç™»å‡º
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* æ¡Œé¢ç‰ˆä½ˆå±€ */}
          {!isMobile && (
            <div className="max-w-7xl mx-auto p-6">
              <div className="grid grid-cols-[280px_1fr] gap-6">
                {/* å·¦å´æ¬„ */}
                <div className="bg-gradient-to-b from-blue-500 to-indigo-600 text-white rounded-2xl p-6 shadow-xl h-fit sticky top-24">
                  <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                    <Icons.User />
                    å®¢æˆ¶è³‡è¨Š
                  </h2>
                  
                  <div className="space-y-3 mb-6">
                    <input type="text" placeholder="å®¢æˆ¶åç¨±" className="w-full p-2.5 rounded-lg text-gray-800 text-sm" 
                      value={custInfo.name} onChange={e => setCustInfo({...custInfo, name: e.target.value})} />
                    <input type="tel" placeholder="é›»è©±" className="w-full p-2.5 rounded-lg text-gray-800 text-sm"
                      value={custInfo.phone} onChange={e => setCustInfo({...custInfo, phone: e.target.value})} />
                    <input type="tel" placeholder="æ‰‹æ©Ÿ" className="w-full p-2.5 rounded-lg text-gray-800 text-sm"
                      value={custInfo.mobile} onChange={e => setCustInfo({...custInfo, mobile: e.target.value})} />
                    <input type="text" placeholder="åœ°å€" className="w-full p-2.5 rounded-lg text-gray-800 text-sm"
                      value={custInfo.address} onChange={e => setCustInfo({...custInfo, address: e.target.value})} />
                    <input type="date" className="w-full p-2.5 rounded-lg text-gray-800 text-sm"
                      value={custInfo.date} onChange={e => setCustInfo({...custInfo, date: e.target.value})} />
                  </div>

                  <div className="space-y-2 mb-6 pt-6 border-t border-white/20">
                    <button onClick={() => setShowModal('favorites')} className="w-full bg-white/20 hover:bg-white/30 p-3 rounded-lg font-bold flex items-center gap-2 transition-colors">
                      <Icons.Star className="icon-svg-sm" />
                      å¸¸ç”¨ç”¢å“
                    </button>
                    <button onClick={() => setShowModal('history')} className="w-full bg-white/20 hover:bg-white/30 p-3 rounded-lg font-bold flex items-center gap-2 transition-colors">
                      <Icons.Clock className="icon-svg-sm" />
                      æ­·å²å ±åƒ¹
                    </button>
                    <button onClick={saveQuote} className="w-full bg-white/20 hover:bg-white/30 p-3 rounded-lg font-bold flex items-center gap-2 transition-colors">
                      <Icons.Save className="icon-svg-sm" />
                      å„²å­˜å ±åƒ¹
                    </button>
                    <button onClick={() => alert('æ™ºèƒ½æ¨è–¦é–‹ç™¼ä¸­...')} className="w-full bg-white/20 hover:bg-white/30 p-3 rounded-lg font-bold flex items-center gap-2 transition-colors">
                      <Icons.Sparkles className="icon-svg-sm" />
                      æ™ºèƒ½æ¨è–¦
                    </button>
                  </div>

                  <div className="pt-6 border-t border-white/20">
                    <p className="text-sm opacity-90 mb-2">ç¸½é‡‘é¡</p>
                    <p className="text-4xl font-black">${total.toLocaleString()}</p>
                  </div>
                </div>

                {/* å³å´ç”¢å“å€ */}
                <div>
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-2xl font-black text-gray-800">ç”¢å“æ¸…å–®</h2>
                    <button onClick={addToCart} className="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 shadow-lg hover:shadow-xl transition-all hover:scale-[1.02]">
                      <Icons.Plus />
                      æ–°å¢ç”¢å“
                    </button>
                  </div>

                  <div className="space-y-2">
                    {cart.map((item, index) => (
                      <div key={item.id} className="bg-white border-2 border-gray-200 rounded-xl p-4 flex items-center gap-4 hover:border-blue-400 hover:shadow-lg transition-all" style={{minHeight: '120px'}}>
                        {/* ç·¨è™Ÿ */}
                        <div className="w-11 h-11 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-xl flex items-center justify-center font-bold text-lg flex-shrink-0 shadow-md">
                          {index + 1}
                        </div>

                        {/* åœ–ç‰‡ */}
                        <div className="w-28 h-28 bg-gray-100 rounded-xl flex items-center justify-center border-2 border-gray-200 cursor-pointer hover:border-blue-400 transition-colors flex-shrink-0 overflow-hidden"
                          onClick={() => uploadImage(item.id)}>
                          {item.image ? (
                            <img src={item.image} alt="ç”¢å“" className="w-full h-full object-cover" />
                          ) : (
                            <Icons.Camera className="icon-svg-lg text-gray-400" />
                          )}
                        </div>

                        {/* ç”¢å“è³‡è¨Š */}
                        <div className="flex-1 flex flex-col gap-2 min-w-0">
                          <input type="text" placeholder="ç”¢å“åç¨±" className="font-bold text-lg border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 px-2 py-1 outline-none transition-colors"
                            value={item.name} onChange={e => updateCart(item.id, 'name', e.target.value)} />
                          <input type="text" placeholder="è¦æ ¼èªªæ˜" className="text-sm text-blue-600 border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 px-2 py-1 outline-none transition-colors"
                            value={item.spec} onChange={e => updateCart(item.id, 'spec', e.target.value)} />
                          
                          <div className="flex items-center gap-2 flex-wrap">
                            <div className="flex items-center gap-1">
                              <span className="text-xs text-gray-600 font-semibold">æ•¸é‡</span>
                              <input type="number" className="w-20 px-2 py-1.5 border-2 border-gray-200 rounded-lg text-center font-bold focus:border-blue-500 outline-none"
                                value={item.qty} onChange={e => updateCart(item.id, 'qty', parseFloat(e.target.value) || 0)} />
                              <select className="px-2 py-1.5 border-2 border-gray-200 rounded-lg font-bold focus:border-blue-500 outline-none"
                                value={item.unit} onChange={e => updateCart(item.id, 'unit', e.target.value)}>
                                <option>ä»¶</option>
                                <option>ç®±</option>
                                <option>ç±ƒ</option>
                              </select>
                            </div>

                            <div className="flex items-center gap-1">
                              <span className="text-xs text-gray-600 font-semibold">å–®åƒ¹ $</span>
                              <input type="number" className="w-20 px-2 py-1.5 border-2 border-gray-200 rounded-lg text-center font-bold focus:border-blue-500 outline-none"
                                value={item.price} onChange={e => updateCart(item.id, 'price', parseFloat(e.target.value) || 0)} />
                              <button onClick={() => showPricePicker(item.id)} className="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-3 py-1.5 rounded-lg font-bold flex items-center gap-1 hover:shadow-lg transition-all">
                                <Icons.DollarSign className="icon-svg-sm" />
                              </button>
                            </div>

                            <div className="text-xl font-bold text-blue-600 ml-auto">
                              ${calculateSubtotal(item).toLocaleString()}
                            </div>

                            <input type="text" placeholder="å‚™è¨»..." className="flex-1 px-3 py-1.5 border-2 border-yellow-300 bg-yellow-50 rounded-lg text-sm focus:border-yellow-500 outline-none min-w-[150px]"
                              value={item.note} onChange={e => updateCart(item.id, 'note', e.target.value)} />
                          </div>
                        </div>

                        {/* æ“ä½œæŒ‰éˆ• */}
                        <div className="flex flex-col gap-1.5 flex-shrink-0">
                          <button onClick={() => uploadImage(item.id)} className="w-10 h-10 bg-gray-100 border-2 border-gray-300 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                            <Icons.Camera className="icon-svg-sm" />
                          </button>
                          <button onClick={() => toggleFavorite(item.id)} className={`w-10 h-10 ${item.isFavorite ? 'bg-yellow-400 border-yellow-500' : 'bg-yellow-100 border-yellow-300'} border-2 rounded-lg hover:bg-yellow-200 transition-colors flex items-center justify-center`}>
                            <Icons.Star filled={item.isFavorite} className="icon-svg-sm" />
                          </button>
                          <button onClick={() => copyCartItem(item.id)} className="w-10 h-10 bg-blue-100 border-2 border-blue-300 rounded-lg hover:bg-blue-200 transition-colors flex items-center justify-center">
                            <Icons.Copy className="icon-svg-sm" />
                          </button>
                          <button onClick={() => deleteFromCart(item.id)} className="w-10 h-10 bg-red-100 border-2 border-red-300 rounded-lg hover:bg-red-200 transition-colors flex items-center justify-center">
                            <Icons.Trash className="icon-svg-sm" />
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* æ‰‹æ©Ÿç‰ˆä½ˆå±€ */}
          {isMobile && (
            <div className="pb-32">
              {/* å®¢æˆ¶è³‡è¨Š */}
              <div className="bg-white m-4 rounded-2xl p-4 shadow-lg">
                <div className="grid grid-cols-2 gap-2.5">
                  <input type="text" placeholder="å®¢æˆ¶åç¨±" className="col-span-2 p-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none transition-colors text-sm"
                    value={custInfo.name} onChange={e => setCustInfo({...custInfo, name: e.target.value})} />
                  <input type="tel" placeholder="é›»è©±" className="p-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none transition-colors text-sm"
                    value={custInfo.phone} onChange={e => setCustInfo({...custInfo, phone: e.target.value})} />
                  <input type="tel" placeholder="æ‰‹æ©Ÿ" className="p-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none transition-colors text-sm"
                    value={custInfo.mobile} onChange={e => setCustInfo({...custInfo, mobile: e.target.value})} />
                  <input type="text" placeholder="åœ°å€" className="p-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none transition-colors text-sm"
                    value={custInfo.address} onChange={e => setCustInfo({...custInfo, address: e.target.value})} />
                  <div className="relative">
                    <input type="date" className="w-full p-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:border-blue-500 outline-none transition-colors text-sm pr-10"
                      value={custInfo.date} onChange={e => setCustInfo({...custInfo, date: e.target.value})} />
                  </div>
                </div>
              </div>

              {/* ç”¢å“åˆ—è¡¨ */}
              <div className="px-4">
                <div className="flex items-center justify-between mb-3">
                  <h2 className="text-base font-bold text-gray-800 flex items-center gap-2">
                    <Icons.Package className="icon-svg-sm" />
                    ç”¢å“æ¸…å–®
                  </h2>
                </div>

                <div className="space-y-2.5">
                  {cart.map((item, index) => (
                    <div key={item.id} className="bg-white border-2 border-gray-200 rounded-2xl p-4 shadow-sm">
                      {/* ç¬¬ä¸€åˆ—ï¼šç·¨è™Ÿ + åç¨± + æŒ‰éˆ• */}
                      <div className="flex items-start gap-2.5 mb-2.5">
                        <div className="w-9 h-9 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-xl flex items-center justify-center font-bold flex-shrink-0 shadow-md text-base">
                          {index + 1}
                        </div>
                        <input type="text" placeholder="é»æ“Šè¼¸å…¥ç”¢å“åç¨±" className="flex-1 font-bold text-base border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 px-1 py-0.5 outline-none transition-colors min-w-0"
                          value={item.name} onChange={e => updateCart(item.id, 'name', e.target.value)} />
                        <div className="flex gap-1 flex-shrink-0">
                          <button onClick={() => uploadImage(item.id)} className="w-8 h-8 bg-gray-100 border-2 border-gray-300 rounded-lg flex items-center justify-center">
                            <Icons.Camera className="icon-svg-sm" />
                          </button>
                          <button onClick={() => toggleFavorite(item.id)} className={`w-8 h-8 ${item.isFavorite ? 'bg-yellow-400' : 'bg-yellow-100'} border-2 border-yellow-300 rounded-lg flex items-center justify-center`}>
                            <Icons.Star filled={item.isFavorite} className="icon-svg-sm" />
                          </button>
                          <button onClick={() => copyCartItem(item.id)} className="w-8 h-8 bg-blue-100 border-2 border-blue-300 rounded-lg flex items-center justify-center">
                            <Icons.Copy className="icon-svg-sm" />
                          </button>
                          <button onClick={() => deleteFromCart(item.id)} className="w-8 h-8 bg-red-100 border-2 border-red-300 rounded-lg flex items-center justify-center">
                            <Icons.Trash className="icon-svg-sm" />
                          </button>
                        </div>
                      </div>

                      {/* ç¬¬äºŒåˆ—ï¼šè¦æ ¼ */}
                      <div className="mb-3 pl-11">
                        <input type="text" placeholder="è¦æ ¼èªªæ˜" className="w-full text-sm text-blue-600 border-b-2 border-transparent hover:border-gray-300 focus:border-blue-500 px-1 py-0.5 outline-none transition-colors"
                          value={item.spec} onChange={e => updateCart(item.id, 'spec', e.target.value)} />
                      </div>

                      {/* ç¬¬ä¸‰åˆ—ï¼šæ•¸é‡ + å–®åƒ¹ */}
                      <div className="flex gap-2.5 mb-3">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 bg-gray-50 border-2 border-gray-200 rounded-xl p-2.5">
                            <span className="text-xs text-gray-500 font-semibold">æ•¸é‡</span>
                            <input type="number" className="flex-1 bg-transparent text-base font-bold text-center outline-none min-w-0"
                              value={item.qty} onChange={e => updateCart(item.id, 'qty', parseFloat(e.target.value) || 0)} />
                            <select className="bg-transparent text-sm font-bold outline-none"
                              value={item.unit} onChange={e => updateCart(item.id, 'unit', e.target.value)}>
                              <option>ä»¶</option>
                              <option>ç®±</option>
                              <option>ç±ƒ</option>
                            </select>
                          </div>
                        </div>

                        <div className="flex-1 flex gap-1.5">
                          <div className="flex-1 flex items-center gap-2 bg-gray-50 border-2 border-gray-200 rounded-xl p-2.5 min-w-0">
                            <span className="text-xs text-gray-500 font-semibold flex-shrink-0">å–®åƒ¹$</span>
                            <input type="number" className="flex-1 bg-transparent text-base font-bold text-center outline-none min-w-0"
                              value={item.price} onChange={e => updateCart(item.id, 'price', parseFloat(e.target.value) || 0)} />
                          </div>
                          <button onClick={() => showPricePicker(item.id)} className="w-11 h-11 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-xl flex items-center justify-center shadow-md flex-shrink-0">
                            <Icons.DollarSign className="icon-svg-sm" />
                          </button>
                        </div>
                      </div>

                      {/* ç¬¬å››åˆ—ï¼šå‚™è¨» + å°è¨ˆ */}
                      <div className="flex gap-2.5 items-center">
                        <input type="text" placeholder="å‚™è¨»..." className="flex-1 px-3 py-2.5 border-2 border-yellow-300 bg-yellow-50 rounded-xl text-sm focus:border-yellow-500 outline-none min-w-0"
                          value={item.note} onChange={e => updateCart(item.id, 'note', e.target.value)} />
                        <div className="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-400 rounded-xl px-3.5 py-2 flex-shrink-0">
                          <p className="text-xs text-gray-600 font-semibold">å°è¨ˆ</p>
                          <p className="text-lg font-bold text-blue-600 whitespace-nowrap">${calculateSubtotal(item).toLocaleString()}</p>
                        </div>
                      </div>

                      {/* åœ–ç‰‡ä¸Šå‚³ */}
                      {item.image && (
                        <div className="mt-3 pt-3 border-t-2 border-dashed border-gray-200">
                          <button onClick={() => uploadImage(item.id)} className="w-full bg-green-100 border-2 border-green-400 text-green-700 py-2.5 rounded-xl font-semibold text-sm flex items-center justify-center gap-2">
                            <Icons.Camera className="icon-svg-sm" />
                            å·²ä¸Šå‚³åœ–ç‰‡ï¼ˆé»æ“Šæ›´æ›ï¼‰
                          </button>
                        </div>
                      )}
                      {!item.image && (
                        <div className="mt-3 pt-3 border-t-2 border-dashed border-gray-200">
                          <button onClick={() => uploadImage(item.id)} className="w-full bg-blue-50 border-2 border-dashed border-blue-300 text-blue-600 py-2.5 rounded-xl font-semibold text-sm flex items-center justify-center gap-2">
                            <Icons.Camera className="icon-svg-sm" />
                            ä¸Šå‚³ç”¢å“åœ–ç‰‡
                          </button>
                        </div>
                      )}
                    </div>
                  ))}
                </div>

                {/* æ–°å¢ç”¢å“æŒ‰éˆ• */}
                <button onClick={addToCart} className="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-4 rounded-2xl font-bold text-base shadow-lg mt-4 flex items-center justify-center gap-2">
                  <Icons.Plus />
                  æ–°å¢ç”¢å“
                </button>
              </div>

              {/* åº•éƒ¨å›ºå®šæ¬„ */}
              <div className="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-200 shadow-2xl z-50">
                {/* ç¬¬ä¸€åˆ— */}
                <div className="grid grid-cols-3 border-b border-gray-200">
                  <button onClick={previewQuote} className="flex flex-col items-center justify-center py-2.5 border-r border-gray-200 text-blue-600 active:bg-gray-50">
                    <Icons.Eye className="icon-svg-lg mb-1" />
                    <span className="text-xs font-semibold">é è¦½</span>
                  </button>
                  <button onClick={shareToLine} className="flex flex-col items-center justify-center py-2.5 border-r border-gray-200 text-green-600 active:bg-gray-50">
                    <Icons.Send className="icon-svg-lg mb-1" />
                    <span className="text-xs font-semibold">LINE</span>
                  </button>
                  <div className="flex flex-col items-center justify-center py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                    <span className="text-xs opacity-90">ç¸½é‡‘é¡</span>
                    <span className="text-lg font-black">${total.toLocaleString()}</span>
                  </div>
                </div>

                {/* ç¬¬äºŒåˆ— */}
                <div className="grid grid-cols-4">
                  <button onClick={() => setShowModal('favorites')} className="flex items-center justify-center gap-1.5 py-2 border-r border-gray-200 active:bg-gray-50">
                    <Icons.Star className="icon-svg-lg" />
                    <span className="text-xs font-semibold">å¸¸ç”¨</span>
                  </button>
                  <button onClick={() => setShowModal('history')} className="flex items-center justify-center gap-1.5 py-2 border-r border-gray-200 active:bg-gray-50">
                    <Icons.Clock className="icon-svg-lg" />
                    <span className="text-xs font-semibold">æ­·å²</span>
                  </button>
                  <button onClick={saveQuote} className="flex items-center justify-center gap-1.5 py-2 border-r border-gray-200 active:bg-gray-50">
                    <Icons.Save className="icon-svg-lg" />
                    <span className="text-xs font-semibold">å„²å­˜</span>
                  </button>
                  <button onClick={() => alert('æ™ºèƒ½æ¨è–¦é–‹ç™¼ä¸­...')} className="flex items-center justify-center gap-1.5 py-2 active:bg-gray-50">
                    <Icons.Sparkles className="icon-svg-lg" />
                    <span className="text-xs font-semibold">æ¨è–¦</span>
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* å½ˆçª— */}
          {showModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[100] p-4" onClick={() => setShowModal(null)}>
              <div className="bg-white rounded-2xl max-w-lg w-full max-h-[80vh] overflow-hidden shadow-2xl" onClick={e => e.stopPropagation()}>
                <div className="px-6 py-4 border-b flex justify-between items-center bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                  <h3 className="font-bold text-lg">
                    {showModal === 'price' && 'ğŸ’° é¸æ“‡åƒ¹æ ¼'}
                    {showModal === 'favorites' && 'â­ å¸¸ç”¨ç”¢å“'}
                    {showModal === 'history' && 'ğŸ“œ æ­·å²å ±åƒ¹'}
                  </h3>
                  <button onClick={() => setShowModal(null)} className="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center text-xl font-bold">âœ•</button>
                </div>

                <div className="p-6 overflow-y-auto max-h-[calc(80vh-80px)]">
                  {showModal === 'price' && (
                    <div className="grid grid-cols-3 gap-3">
                      {Object.entries(priceTiers).flatMap(([tier, prices]) =>
                        prices.map(price => (
                          <button key={`${tier}-${price}`} onClick={() => selectPrice(price)}
                            className="p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-colors">
                            <div className="text-xs text-gray-500 mb-1">{tier}</div>
                            <div className="text-xl font-bold">${price}</div>
                          </button>
                        ))
                      )}
                    </div>
                  )}

                  {showModal === 'favorites' && (
                    <div className="space-y-2">
                      {favorites.length === 0 ? (
                        <p className="text-center text-gray-400 py-10">å°šç„¡å¸¸ç”¨ç”¢å“</p>
                      ) : (
                        favorites.map((fav, i) => (
                          <div key={i} onClick={() => { addToCart(); updateCart(cart[cart.length-1]?.id, 'name', fav.name); updateCart(cart[cart.length-1]?.id, 'spec', fav.spec); updateCart(cart[cart.length-1]?.id, 'price', fav.price); setShowModal(null); }}
                            className="p-4 border-2 border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-colors">
                            <div className="font-bold mb-1">{fav.name}</div>
                            <div className="text-sm text-blue-600">{fav.spec}</div>
                            <div className="text-sm text-gray-600 mt-1">${fav.price}</div>
                          </div>
                        ))
                      )}
                    </div>
                  )}

                  {showModal === 'history' && (
                    <div className="space-y-2">
                      {quotes.length === 0 ? (
                        <p className="text-center text-gray-400 py-10">å°šç„¡æ­·å²å ±åƒ¹</p>
                      ) : (
                        [...quotes].reverse().map(quote => {
                          const date = new Date(quote.date);
                          const dateStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;
                          return (
                            <div key={quote.id} className="p-4 border-2 border-gray-200 rounded-xl">
                              <div className="flex justify-between items-start mb-2">
                                <div>
                                  <div className="font-bold">{quote.customer.name || 'æœªå‘½åå®¢æˆ¶'}</div>
                                  <div className="text-xs text-gray-500">{dateStr}</div>
                                </div>
                                <div className="text-right">
                                  <div className="text-xl font-bold text-blue-600">${quote.total.toLocaleString()}</div>
                                  <div className="text-xs text-gray-500">{quote.products.length} é …</div>
                                </div>
                              </div>
                              <div className="flex gap-2 mt-3">
                                <button onClick={() => loadQuote(quote.id)} className="flex-1 bg-blue-500 text-white py-2 rounded-lg font-bold">è¼‰å…¥</button>
                                <button onClick={() => deleteQuote(quote.id)} className="px-4 bg-red-100 text-red-600 py-2 rounded-lg font-bold">åˆªé™¤</button>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    // æ¸²æŸ“
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>